"use strict";(()=>{var e={};e.id=81,e.ids=[81],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},83554:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>m,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>P,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>l});var n=t(49303),s=t(88716),i=t(60670),a=t(87070),u=t(75571),p=t(90455);let c={1:{name:"Cultivator",qiBoostPercent:100,pricePerMonth:5},2:{name:"Dao Seeker",qiBoostPercent:200,pricePerMonth:10},3:{name:"Immortal",qiBoostPercent:400,pricePerMonth:15},4:{name:"Divine",qiBoostPercent:800,pricePerMonth:22}},d={1:0,6:10,12:20};async function l(e){try{let{tierId:r,months:t,amount:o,discordId:n,server:s}=await e.json(),i=await (0,u.getServerSession)(p.L),l=i?.user?.id||n;if(!l)return a.NextResponse.json({error:"Unauthorized"},{status:401});let f=c[r];if(!f)return a.NextResponse.json({error:"Invalid tier"},{status:400});if(![1,6,12].includes(t))return a.NextResponse.json({error:"Invalid duration"},{status:400});let h=function(e,r){let t=c[e];if(!t)return 0;let o=t.pricePerMonth*r,n=d[r]||0;return Math.round((o-o*n/100)*100)/100}(r,t);if(Math.abs(o-h)>.01)return a.NextResponse.json({error:"Price mismatch"},{status:400});let y=process.env.PAYPAL_CLIENT_ID,P=process.env.PAYPAL_CLIENT_SECRET,x="live"===process.env.PAYPAL_MODE?"https://api-m.paypal.com":"https://api-m.sandbox.paypal.com";if(!y||!P)return a.NextResponse.json({error:"Payment system not configured"},{status:500});let m=Buffer.from(`${y}:${P}`).toString("base64"),b=await fetch(`${x}/v1/oauth2/token`,{method:"POST",headers:{Authorization:`Basic ${m}`,"Content-Type":"application/x-www-form-urlencoded"},body:"grant_type=client_credentials"});if(!b.ok)return console.error("PayPal token error"),a.NextResponse.json({error:"Payment initialization failed"},{status:500});let{access_token:v}=await b.json(),_=`subscription:${r}:${t}:${l}:${s||"S0"}`,j=`DaoVerse ${f.name} Subscription - ${t} Month${t>1?"s":""}`,g=e.headers.get("x-forwarded-host")||e.headers.get("host"),O=e.headers.get("x-forwarded-proto")||"https",q=g?`${O}://${g}`:process.env.NEXT_PUBLIC_BASE_URL||"https://buydaocoins.replit.app",w=await fetch(`${x}/v2/checkout/orders`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({intent:"CAPTURE",purchase_units:[{amount:{currency_code:"USD",value:o.toFixed(2)},description:j,custom_id:_}],application_context:{brand_name:"DaoVerse",landing_page:"NO_PREFERENCE",user_action:"PAY_NOW",return_url:`${q}/shop/subscriptions/return`,cancel_url:`${q}/shop/subscriptions`}})});if(!w.ok)return console.error("PayPal order creation error"),a.NextResponse.json({error:"Failed to create payment order"},{status:500});let E=await w.json(),R=E.links?.find(e=>"approve"===e.rel)?.href;if(!R)return a.NextResponse.json({error:"Failed to get payment URL"},{status:500});return a.NextResponse.json({orderId:E.id,approvalUrl:R})}catch(e){return console.error("Error creating subscription order:",e),a.NextResponse.json({error:"Failed to create order"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/subscriptions/create-order/route",pathname:"/api/subscriptions/create-order",filename:"route",bundlePath:"app/api/subscriptions/create-order/route"},resolvedPagePath:"/var/www/buydaocoins.aethexiz.com/app/api/subscriptions/create-order/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:P}=f,x="/api/subscriptions/create-order/route";function m(){return(0,i.patchFetch)({serverHooks:P,staticGenerationAsyncStorage:y})}},90455:(e,r,t)=>{t.d(r,{L:()=>o});let o={providers:[(0,t(19475).Z)({clientId:process.env.CLIENT_ID,clientSecret:process.env.CLIENT_SECRET})],callbacks:{session:async({session:e,token:r})=>(e.user&&(e.user.id=r.sub),e)},pages:{signIn:"/"}}},69955:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},75571:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});var o={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return s.default}});var n=t(69955);Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(o,e))&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))});var s=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i(void 0);if(t&&t.has(e))return t.get(e);var o={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var a=n?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=e[s]}return o.default=e,t&&t.set(e,o),o}(t(45609));function i(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(i=function(e){return e?t:r})(e)}Object.keys(s).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(o,e))&&(e in r&&r[e]===s[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return s[e]}}))})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[276,972,694],()=>t(83554));module.exports=o})();