(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[718],{6501:function(e,s,t){Promise.resolve().then(t.bind(t,637))},637:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var n=t(7437),a=t(9376),r=t(2265),l=t(6631);function i(){let{isAuthenticated:e,isLoading:s,discordId:t,server:i}=(0,l.a)(),c=(0,a.useRouter)(),o=(0,a.useSearchParams)(),[u,d]=(0,r.useState)("loading"),[m,x]=(0,r.useState)("Processing payment...");return((0,r.useEffect)(()=>{let n=async()=>{try{let e=o.get("token");if(!e){d("error"),x("No payment token found. Payment cancelled.");return}let s=await fetch("/api/payment/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e,discordId:t,server:i})}),n=await s.json();s.ok?(d("success"),x(n.message||"Payment successful! Your purchase has been activated."),setTimeout(()=>{c.push("/")},3e3)):(d("error"),x(n.message||"Payment failed. Please try again."))}catch(e){console.error("Payment processing error:",e),d("error"),x("An error occurred while processing your payment.")}};!s&&e&&t?n():s||e||(d("error"),x("Please sign in to complete your purchase."))},[s,e,t,i,o,c]),s||"loading"===u)?(0,n.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("div",{className:"text-base md:text-lg text-amber-400 font-medium",children:"Processing Payment..."})]})}):e?(0,n.jsx)("div",{className:"h-screen flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"w-full max-w-sm animate-scale-in",children:(0,n.jsxs)("div",{className:"glass rounded-3xl p-8 shadow-2xl text-center",children:[(0,n.jsx)("div",{className:"mb-6",children:"success"===u?(0,n.jsx)("div",{className:"text-6xl mb-4",children:"✅"}):(0,n.jsx)("div",{className:"text-6xl mb-4",children:"❌"})}),(0,n.jsx)("h1",{className:"text-2xl font-bold mb-3 ".concat("success"===u?"text-green-400":"text-red-400"),children:"success"===u?"Payment Successful!":"Payment Failed"}),(0,n.jsx)("p",{className:"text-gray-300 mb-6 text-sm",children:m}),"success"===u?(0,n.jsx)("p",{className:"text-gray-400 text-xs mb-6",children:"Redirecting to home page in 3 seconds..."}):(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{onClick:()=>c.back(),className:"w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-5 rounded-xl transition-all",children:"Try Again"}),(0,n.jsx)("button",{onClick:()=>c.push("/"),className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-5 rounded-xl transition-all",children:"Return Home"})]})]})})}):(0,n.jsx)("div",{className:"h-screen flex items-center justify-center p-4",children:(0,n.jsx)("div",{className:"w-full max-w-sm animate-scale-in",children:(0,n.jsxs)("div",{className:"glass rounded-3xl p-6 shadow-2xl",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-amber-400 mb-4",children:"Sign in Required"}),(0,n.jsx)("p",{className:"text-gray-300 mb-6",children:"Please sign in to complete your payment"}),(0,n.jsx)("button",{onClick:()=>c.push("/"),className:"w-full bg-[#5865F2] hover:bg-[#4752C4] text-white font-semibold py-3 px-5 rounded-xl transition-all",children:"Go to Login"})]})})})}function c(){return(0,n.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-3 animate-fade-in",children:[(0,n.jsx)("div",{className:"spinner"}),(0,n.jsx)("div",{className:"text-base md:text-lg text-amber-400 font-medium",children:"Loading..."})]})})}function o(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)(c,{}),children:(0,n.jsx)(i,{})})}},6631:function(e,s,t){"use strict";t.d(s,{a:function(){return r}});var n=t(605),a=t(2265);function r(){let{data:e,status:s}=(0,n.useSession)(),[t,r]=(0,a.useState)(null),[l,i]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{{let e=localStorage.getItem("codeAuth");if(e)try{r(JSON.parse(e))}catch(e){localStorage.removeItem("codeAuth")}i(!0)}},[]),null==e?void 0:e.user)?{isAuthenticated:!0,isLoading:!1,discordId:e.user.id||null,server:"S0",userName:e.user.name||null,userImage:e.user.image||null,isCodeAuth:!1,logout:()=>{}}:t?{isAuthenticated:!0,isLoading:!1,discordId:t.discordId,server:t.server,userName:null,userImage:null,isCodeAuth:!0,logout:()=>{t&&(localStorage.removeItem("codeAuth"),r(null),window.location.reload())}}:{isAuthenticated:!1,isLoading:"loading"===s||!l,discordId:null,server:null,userName:null,userImage:null,isCodeAuth:!1,logout:()=>{}}}},9376:function(e,s,t){"use strict";var n=t(5475);t.o(n,"usePathname")&&t.d(s,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(s,{useRouter:function(){return n.useRouter}}),t.o(n,"useSearchParams")&&t.d(s,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[605,971,117,744],function(){return e(e.s=6501)}),_N_E=e.O()}]);