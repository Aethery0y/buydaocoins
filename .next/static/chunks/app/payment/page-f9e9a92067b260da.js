(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[790],{9427:function(e,t,s){Promise.resolve().then(s.bind(s,9549))},9549:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),n=s(9376),r=s(2265),l=s(1542),i=s(7882),c=s.n(i),o=s(3145),d=s(8629),m=s(3433),x=s(4645),u=s(6631);let h=[1,5,10,20,50];function p(){let{isAuthenticated:e,isLoading:t,discordId:s,server:i}=(0,u.a)(),p=(0,n.useRouter)(),[b,j]=(0,r.useState)(5),[f,g]=(0,r.useState)(""),[N,y]=(0,r.useState)("idle"),[v,w]=(0,r.useState)({coins:0,txId:""}),[C,S]=(0,r.useState)(""),[k,O]=(0,r.useState)(null),[P,I]=(0,r.useState)(!1),T=k?Math.floor(k.bonusPercentage/100*b):0,D=b+T;if((0,r.useEffect)(()=>{if(!C.trim()){O(null);return}let e=setTimeout(async()=>{I(!0);try{let e=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:C.trim(),amount:b})}),t=await e.json();O(t.valid?t:null)}catch(e){O(null)}finally{I(!1)}},500);return()=>clearTimeout(e)},[C,b]),t)return(0,a.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"spinner"})});if(!e)return p.push("/"),null;let E=async()=>{let e=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:b,couponCode:(null==k?void 0:k.code)||null,packages:[],discordId:s,server:i})}),t=await e.json();if(!e.ok)throw Error(t.error);return t.orderId},_=async e=>{y("processing");try{let t=await fetch("/api/paypal/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.orderID,discordId:s,server:i})}),a=await t.json();if(!t.ok)throw Error(a.error);w({coins:a.daoCoins,txId:a.transactionId}),y("success"),setTimeout(()=>p.push("/success?coins=".concat(a.daoCoins,"&txId=").concat(a.transactionId)),2500)}catch(e){g(e.message),y("error")}};return"processing"===N?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-40 h-40 mx-auto mb-4",children:(0,a.jsx)(c(),{animationData:d,loop:!0})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-blue-400",children:"Processing Payment"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Please wait..."})]})}):"success"===N?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-48 h-48 mx-auto",children:(0,a.jsx)(c(),{animationData:m,loop:!1})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,a.jsxs)("span",{className:"text-3xl font-bold text-amber-400",children:["+",v.coins]}),(0,a.jsx)(o.default,{src:"/dao-coin.png",alt:"DC",width:28,height:28})]}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Redirecting..."})]})}):"error"===N?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-40 h-40 mx-auto mb-4",children:(0,a.jsx)(c(),{animationData:x,loop:!1})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-red-400",children:"Payment Failed"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2 mb-4",children:f||"Something went wrong"}),(0,a.jsx)("button",{onClick:()=>{y("idle"),g("")},className:"bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-xl",children:"Try Again"})]})}):(0,a.jsx)("div",{className:"min-h-screen p-4 pb-24 md:pb-8",children:(0,a.jsxs)("div",{className:"max-w-lg mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("button",{onClick:()=>p.push("/shop"),className:"text-gray-400 hover:text-white text-sm",children:"← Back"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-amber-400",children:"Buy DAO Coins"}),(0,a.jsx)("div",{className:"w-12"})]}),(0,a.jsxs)("div",{className:"glass rounded-xl p-5 mb-4 text-center",children:[(0,a.jsx)(o.default,{src:"/dao-coin.png",alt:"DC",width:48,height:48,className:"mx-auto mb-3"}),(0,a.jsxs)("div",{className:"text-3xl font-bold text-amber-400 mb-1",children:["$",b," = ",D," DC"]}),T>0&&(0,a.jsxs)("div",{className:"text-green-400 text-sm",children:["+",T," bonus coins!"]})]}),(0,a.jsxs)("div",{className:"glass rounded-xl p-4 mb-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-3 font-medium",children:"Quick Select"}),(0,a.jsx)("div",{className:"grid grid-cols-5 gap-2",children:h.map(e=>(0,a.jsxs)("button",{onClick:()=>j(e),className:"py-2 rounded-lg font-bold text-sm transition-all ".concat(b===e?"bg-amber-500 text-slate-900":"bg-white/5 text-gray-300 hover:bg-white/10"),children:["$",e]},e))})]}),(0,a.jsxs)("div",{className:"glass rounded-xl p-4 mb-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-2 font-medium",children:"Custom Amount"}),(0,a.jsx)("input",{type:"number",min:"1",value:b,onChange:e=>j(Math.max(1,parseInt(e.target.value)||1)),className:"w-full bg-white/5 text-white p-3 rounded-lg border border-white/10 focus:border-amber-400 focus:outline-none"})]}),(0,a.jsxs)("div",{className:"glass rounded-xl p-4 mb-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-2 font-medium",children:"Coupon Code (Optional)"}),(0,a.jsx)("input",{type:"text",value:C,onChange:e=>S(e.target.value.toUpperCase()),placeholder:"Enter code",className:"w-full bg-white/5 text-white p-3 rounded-lg border border-white/10 focus:border-amber-400 focus:outline-none uppercase"}),k&&(0,a.jsxs)("div",{className:"text-green-400 text-xs mt-2",children:["✓ ",k.bonusPercentage,"% bonus applied!"]})]}),(0,a.jsx)("div",{className:"rounded-xl overflow-hidden mb-4",children:(0,a.jsx)(l.ch,{createOrder:E,onApprove:_,onError:e=>{console.error(e),g("Payment failed"),y("error")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal"},disabled:b<1})}),(0,a.jsxs)("div",{className:"text-center text-gray-500 text-xs space-y-1",children:[(0,a.jsx)("p",{children:"✓ Instant delivery • ✓ Secure payment"}),(0,a.jsx)("p",{children:"All purchases are final"})]})]})})}}},function(e){e.O(0,[705,605,145,536,882,967,971,117,744],function(){return e(e.s=9427)}),_N_E=e.O()}]);