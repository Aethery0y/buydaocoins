(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[845],{7942:function(e,t,s){Promise.resolve().then(s.bind(s,357))},357:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(7437),r=s(9376),n=s(2265),i=s(3145),l=s(1542),c=s(7882),d=s.n(c),o=s(8629),x=s(3433),m=s(4645),h=s(6631);let u=[{id:"pkg1",name:"Starter",coins:50,price:40,regular:50,discount:20},{id:"pkg2",name:"Popular",coins:100,price:80,regular:100,discount:20,badge:"POPULAR"},{id:"pkg3",name:"Great Value",coins:150,price:125,regular:150,discount:17,badge:"BEST VALUE"},{id:"pkg4",name:"Ultimate",coins:200,price:150,regular:200,discount:25}];function p(){let{isAuthenticated:e,isLoading:t,discordId:s,server:c}=(0,h.a)(),p=(0,r.useRouter)(),[j,g]=(0,n.useState)({}),[f,b]=(0,n.useState)("idle"),[N,y]=(0,n.useState)(""),[v,w]=(0,n.useState)(0);if(t)return(0,a.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"spinner"})});if(!e)return p.push("/"),null;let k=e=>{g(t=>{if(t[e]){let{[e]:s,...a}=t;return a}return{...t,[e]:1}})},C=(e,t)=>{g(s=>{let a=(s[e]||0)+t;if(a<=0){let{[e]:t,...a}=s;return a}return{...s,[e]:a}})},P=Object.entries(j).map(e=>{let[t,s]=e;return{...u.find(e=>e.id===t),qty:s}}),S=P.reduce((e,t)=>e+t.price*t.qty,0),O=P.reduce((e,t)=>e+t.coins*t.qty,0),T=P.reduce((e,t)=>e+(t.regular-t.price)*t.qty,0),E=async()=>{let e=await fetch("/api/paypal/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:S,couponCode:null,packages:P,discordId:s,server:c})}),t=await e.json();if(!e.ok)throw Error(t.error);return t.orderId},D=async e=>{b("processing");try{let t=await fetch("/api/paypal/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:e.orderID,discordId:s,server:c})}),a=await t.json();if(!t.ok)throw Error(a.error);w(a.daoCoins),b("success"),setTimeout(()=>p.push("/success?coins=".concat(a.daoCoins,"&txId=").concat(a.transactionId)),2500)}catch(e){y(e.message),b("error")}};return"processing"===f?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-40 h-40 mx-auto mb-4",children:(0,a.jsx)(d(),{animationData:o,loop:!0})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-blue-400",children:"Processing Payment"})]})}):"success"===f?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-48 h-48 mx-auto",children:(0,a.jsx)(d(),{animationData:x,loop:!1})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,a.jsxs)("span",{className:"text-3xl font-bold text-amber-400",children:["+",v]}),(0,a.jsx)(i.default,{src:"/dao-coin.png",alt:"DC",width:28,height:28})]}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Redirecting..."})]})}):"error"===f?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"glass rounded-2xl p-8 text-center max-w-sm w-full",children:[(0,a.jsx)("div",{className:"w-40 h-40 mx-auto mb-4",children:(0,a.jsx)(d(),{animationData:m,loop:!1})}),(0,a.jsx)("h2",{className:"text-xl font-bold text-red-400",children:"Payment Failed"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm mt-2 mb-4",children:N}),(0,a.jsx)("button",{onClick:()=>{b("idle"),y("")},className:"bg-amber-500 hover:bg-amber-600 text-slate-900 font-bold py-3 px-6 rounded-xl",children:"Try Again"})]})}):(0,a.jsx)("div",{className:"min-h-screen p-4 pb-24 md:pb-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("button",{onClick:()=>p.push("/shop"),className:"text-gray-400 hover:text-white text-sm",children:"← Back"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-amber-400",children:"Special Offers"}),(0,a.jsx)("div",{className:"w-12"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:u.map(e=>{let t=j[e.id]||0,s=t>0;return(0,a.jsxs)("div",{onClick:()=>k(e.id),className:"relative glass rounded-xl p-4 cursor-pointer transition-all ".concat(s?"ring-2 ring-amber-400":"hover:bg-white/5"),children:[e.badge&&(0,a.jsx)("div",{className:"absolute -top-2 left-1/2 -translate-x-1/2 text-white text-[10px] font-bold px-2 py-0.5 rounded-full ".concat("POPULAR"===e.badge?"bg-purple-500":"bg-green-500"),children:e.badge}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-amber-400 flex items-center justify-center gap-1",children:[e.coins," ",(0,a.jsx)(i.default,{src:"/dao-coin.png",alt:"DC",width:20,height:20})]}),(0,a.jsxs)("div",{className:"text-lg font-bold text-white",children:["$",e.price]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-1 text-xs",children:[(0,a.jsxs)("span",{className:"text-gray-500 line-through",children:["$",e.regular]}),(0,a.jsxs)("span",{className:"text-red-400 font-bold",children:["-",e.discount,"%"]})]})]}),s&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-white/10 flex items-center justify-center gap-3",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{onClick:()=>C(e.id,-1),className:"w-7 h-7 bg-white/10 hover:bg-white/20 rounded-lg font-bold",children:"-"}),(0,a.jsx)("span",{className:"text-white font-bold w-6 text-center",children:t}),(0,a.jsx)("button",{onClick:()=>C(e.id,1),className:"w-7 h-7 bg-white/10 hover:bg-white/20 rounded-lg font-bold",children:"+"})]})]},e.id)})}),P.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"glass rounded-xl p-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Packages"}),(0,a.jsx)("span",{className:"text-white",children:P.map(e=>"".concat(e.name," \xd7").concat(e.qty)).join(", ")})]}),T>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"You Save"}),(0,a.jsxs)("span",{className:"text-green-400 font-bold",children:["$",T]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pt-2 border-t border-white/10",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"text-white font-bold text-lg",children:["$",S]}),(0,a.jsx)("div",{className:"text-gray-500 text-xs",children:"Total"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-2xl font-bold text-amber-400",children:[O," ",(0,a.jsx)(i.default,{src:"/dao-coin.png",alt:"DC",width:24,height:24})]})]})]}),(0,a.jsx)("div",{className:"rounded-xl overflow-hidden mb-4",children:(0,a.jsx)(l.ch,{createOrder:E,onApprove:D,onError:e=>{console.error(e),y("Payment failed"),b("error")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal"}})})]}),0===P.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:"Tap a package to select it"}),(0,a.jsx)("p",{className:"text-center text-gray-500 text-xs",children:"✓ Instant delivery • ✓ Secure payment"})]})})}}},function(e){e.O(0,[705,605,145,536,882,967,971,117,744],function(){return e(e.s=7942)}),_N_E=e.O()}]);