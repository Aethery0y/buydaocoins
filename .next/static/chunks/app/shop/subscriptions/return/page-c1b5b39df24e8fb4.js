(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[614],{9032:function(e,t,s){Promise.resolve().then(s.bind(s,3086))},3086:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return c}});var r=s(7437),n=s(2265),a=s(9376),i=s(7648),o=s(6631);function l(){let e=(0,a.useSearchParams)();(0,a.useRouter)();let{discordId:t,server:s}=(0,o.a)(),[l,c]=(0,n.useState)("processing"),[u,d]=(0,n.useState)("Processing your subscription..."),[m,x]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let r=async()=>{try{let r=e.get("token");if(!r){c("error"),d("No payment token found. Payment cancelled.");return}let n=await fetch("/api/subscriptions/capture-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:r,discordId:t,server:s||"S0"})}),a=await n.json();n.ok?(c("success"),d("Your subscription has been activated!"),x(a.subscription)):(c("error"),d(a.error||"Payment failed. Please try again."))}catch(e){console.error("Payment processing error:",e),c("error"),d("An error occurred while processing your payment.")}};t&&r()},[e,t,s]),(0,r.jsx)("div",{className:"h-screen flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"w-full max-w-md animate-scale-in",children:(0,r.jsxs)("div",{className:"glass rounded-3xl p-8 shadow-2xl text-center",children:["processing"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"spinner mx-auto mb-6"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-amber-400 mb-4",children:"Processing Payment"}),(0,r.jsx)("p",{className:"text-gray-300",children:u})]}),"success"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-6xl mb-6",children:"✅"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-green-400 mb-4",children:"Subscription Activated!"}),(0,r.jsx)("p",{className:"text-gray-300 mb-6",children:u}),m&&(0,r.jsxs)("div",{className:"bg-gray-800/50 rounded-xl p-4 mb-6",children:[(0,r.jsx)("p",{className:"text-amber-400 font-semibold",children:m.tierName}),(0,r.jsxs)("p",{className:"text-gray-300",children:["+",m.qiBoostPercent,"% Qi Boost"]}),(0,r.jsxs)("p",{className:"text-gray-400 text-sm",children:["Expires: ",new Date(m.expiresAt).toLocaleDateString()]})]}),(0,r.jsx)(i.default,{href:"/shop/subscriptions",className:"inline-block bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold py-3 px-6 rounded-xl transition-all",children:"Return to Subscriptions"})]}),"error"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-6xl mb-6",children:"❌"}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"Payment Failed"}),(0,r.jsx)("p",{className:"text-gray-300 mb-6",children:u}),(0,r.jsx)(i.default,{href:"/shop/subscriptions",className:"inline-block bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold py-3 px-6 rounded-xl transition-all",children:"Try Again"})]})]})})})}function c(){return(0,r.jsx)(n.Suspense,{fallback:(0,r.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,r.jsx)("div",{className:"spinner"})}),children:(0,r.jsx)(l,{})})}},6631:function(e,t,s){"use strict";s.d(t,{a:function(){return a}});var r=s(605),n=s(2265);function a(){let{data:e,status:t}=(0,r.useSession)(),[s,a]=(0,n.useState)(null),[i,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{{let e=localStorage.getItem("codeAuth");if(e)try{a(JSON.parse(e))}catch(e){localStorage.removeItem("codeAuth")}o(!0)}},[]),null==e?void 0:e.user)?{isAuthenticated:!0,isLoading:!1,discordId:e.user.id||null,server:"S0",userName:e.user.name||null,userImage:e.user.image||null,isCodeAuth:!1,logout:()=>{}}:s?{isAuthenticated:!0,isLoading:!1,discordId:s.discordId,server:s.server,userName:null,userImage:null,isCodeAuth:!0,logout:()=>{s&&(localStorage.removeItem("codeAuth"),a(null),window.location.reload())}}:{isAuthenticated:!1,isLoading:"loading"===t||!i,discordId:null,server:null,userName:null,userImage:null,isCodeAuth:!1,logout:()=>{}}}},9376:function(e,t,s){"use strict";var r=s(5475);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},5523:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return r}});let r=s(7043)._(s(2265)).default.createContext(null)}},function(e){e.O(0,[605,648,971,117,744],function(){return e(e.s=9032)}),_N_E=e.O()}]);